<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Minimization and Maximization of Functions – Computational Physics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-integration.html" rel="next">
<link href="./05-roots.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0dd2bd5de344125cf763a379ddc3eb04.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-extrema.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Minimization and Maximization of Functions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Computational Physics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Interpolation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-roots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Finding the Root of a Function</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-extrema.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Minimization and Maximization of Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Numerical Integration</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-odes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Numerical Integration of Ordinary Differential Equations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The Modeling of Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-min-1D" id="toc-sec-min-1D" class="nav-link active" data-scroll-target="#sec-min-1D"><span class="header-section-number">3.1</span> The Minimization of 1-D Functions</a>
  <ul class="collapse">
  <li><a href="#bracketing-a-minimum-in-1-d" id="toc-bracketing-a-minimum-in-1-d" class="nav-link" data-scroll-target="#bracketing-a-minimum-in-1-d"><span class="header-section-number">3.1.1</span> Bracketing a Minimum in 1-D</a></li>
  <li><a href="#bracketing-a-minimum-in-1-d-with-derivatives" id="toc-bracketing-a-minimum-in-1-d-with-derivatives" class="nav-link" data-scroll-target="#bracketing-a-minimum-in-1-d-with-derivatives"><span class="header-section-number">3.1.2</span> Bracketing a Minimum in 1-D with Derivatives</a></li>
  <li><a href="#an-aside---how-to-get-gnuplot-to-fit-a-line-to-data" id="toc-an-aside---how-to-get-gnuplot-to-fit-a-line-to-data" class="nav-link" data-scroll-target="#an-aside---how-to-get-gnuplot-to-fit-a-line-to-data"><span class="header-section-number">3.1.3</span> An Aside - How to get Gnuplot to fit a line to data</a></li>
  </ul></li>
  <li><a href="#the-minimization-of-multi-dimensional-functions" id="toc-the-minimization-of-multi-dimensional-functions" class="nav-link" data-scroll-target="#the-minimization-of-multi-dimensional-functions"><span class="header-section-number">3.2</span> The Minimization of Multi-dimensional Functions</a>
  <ul class="collapse">
  <li><a href="#the-multidimensional-downhill-simplex-method" id="toc-the-multidimensional-downhill-simplex-method" class="nav-link" data-scroll-target="#the-multidimensional-downhill-simplex-method"><span class="header-section-number">3.2.1</span> The Multidimensional Downhill Simplex Method</a></li>
  <li><a href="#powells-method" id="toc-powells-method" class="nav-link" data-scroll-target="#powells-method"><span class="header-section-number">3.2.2</span> Powell’s Method</a></li>
  </ul></li>
  <li><a href="#optimization-in-python" id="toc-optimization-in-python" class="nav-link" data-scroll-target="#optimization-in-python"><span class="header-section-number">3.3</span> Optimization in Python</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Minimization and Maximization of Functions</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The determination of the minima or the maxima of functions, including 1-D and multi-dimensional functions, is an important problem not only in physics but throughout quantitative science. For instance, in physics and astronomy, many quantities come to a maximum at an intermediate value of a certain parameter. In the spectra of stars, the hydrogen lines come to their maximum strength at a temperature of about <span class="math inline">\(10{,}000\,\text{K}\)</span>. Stars with temperatures both lower and higher than this have relatively weak hydrogen lines. The investigation of this phenomenon can lead to insights into the physics of stars. The theory of orbits in classical mechanics leads to the concept of an <em>effective potential</em>. Depending upon the nature of the central force and the angular momentum of the particle, the effective potential can have a minimum at a certain radius. A stable circular orbit is then possible at that radius. Around black holes, this effective potential has not only a minimum but also a maximum. At the minimum, stable circular orbits are possible. Inside of the maximum, the particle is irretrievably drawn into the black hole. Knowledge of the location of this maximum is of obvious importance if you are orbiting around a black hole!</p>
<p>The determination of a minimum of a multi-dimensional function is related to the question of optimization. For instance, a common question to ask in physics is: “What combination of parameters yields the best fit of a model to the experimental or observational results?””</p>
<p>That this is a problem related to minimization becomes clear when one considers a function <span class="math inline">\(f(x_1, x_2, x_3, \ldots)\)</span> which is equal to the sum of the squared differences between the theoretical model and the experimental results. The variables <span class="math inline">\(x_1, x_2, x_3, \ldots\)</span> are the model parameters, and we can consider them to define an <span class="math inline">\(n\)</span>-dimensional space. The function <span class="math inline">\(f\)</span> then takes on a value at each point in this <span class="math inline">\(n\)</span>-dimensional space, and the problem reduces to finding the global minimum of <span class="math inline">\(f\)</span>.</p>
<p>Finding the maximum of a function is equivalent to finding a minimum, because if <span class="math inline">\(f(x)\)</span> has a maximum at <span class="math inline">\(x_m\)</span>, then <span class="math inline">\(-f(x)\)</span> has a minimum at the same point <span class="math inline">\(x_m\)</span>. Thus, in what follows, we will consider algorithms to determine the <em>minimum</em> of a function only.</p>
<p>Let us first begin with 1-D functions, and then move on to multi-dimensional functions.</p>
<section id="sec-min-1D" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-min-1D"><span class="header-section-number">3.1</span> The Minimization of 1-D Functions</h2>
<p>Analogous to <a href="05-roots.html" class="quarto-xref"><span>Chapter 2</span></a>, in which we considered how to find the root of a 1-D function, we can divide the problem into functions for which we can determine the first derivative and those for which we cannot. Let us first consider the case for which we cannot determine the derivative, or are too lazy to do so.</p>
<section id="bracketing-a-minimum-in-1-d" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="bracketing-a-minimum-in-1-d"><span class="header-section-number">3.1.1</span> Bracketing a Minimum in 1-D</h3>
<p>In <a href="05-roots.html#sec-bisection" class="quarto-xref"><span>Section 2.1</span></a> we used the method of bisection to zero in on the root of a 1-D function. We can use a similar method here, but we must first define what we mean by “bracketing” a minimum. A minimum can be bracketed only by a triplet of points <span class="math inline">\(a &lt; b &lt; c\)</span> such that <span class="math inline">\(f(b)\)</span> is less than both <span class="math inline">\(f(a)\)</span> and <span class="math inline">\(f(c)\)</span>. Only then do we know that the function has a minimum in the interval <span class="math inline">\((a, c)\)</span> (see <a href="#fig-parab-min" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>). To zero in on the minimum, we choose a new point <span class="math inline">\(x\)</span>, which is either between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, or between <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span>. Let us suppose <span class="math inline">\(x\)</span> is between <span class="math inline">\(b\)</span> and <span class="math inline">\(c\)</span>. We evaluate <span class="math inline">\(f(x)\)</span>. If <span class="math inline">\(f(b) &lt; f(x)\)</span>, then we replace <span class="math inline">\(c\)</span> with <span class="math inline">\(x\)</span>. If, however, <span class="math inline">\(f(b) &gt; f(x)\)</span>, then the new bracketing triplet is <span class="math inline">\((b, x, c)\)</span>.<br>
We continue until we know the position of the minimum to a precision consistent with both our needs and the machine precision.</p>
<div id="cell-fig-parab-min" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div id="fig-parab-min" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-parab-min-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-parab-min-output-1.png" width="471" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parab-min-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: A parabola we want to minimize
</figcaption>
</figure>
</div>
</div>
</div>
<p>How do we choose <span class="math inline">\(x\)</span>? There are a number of ways to choose <span class="math inline">\(x\)</span>, but a straightforward way is to take <span class="math inline">\(x\)</span> halfway through the larger of the two intervals <span class="math inline">\((a, b)\)</span> and <span class="math inline">\((b, c)\)</span>.</p>
<p>We use the following algorithm:</p>
<ul>
<li><strong>If</strong> the interval <span class="math inline">\((a, b)\)</span> is larger than <span class="math inline">\((b, c)\)</span>:<br>
Take <span class="math inline">\(x = (a + b)/2\)</span> and find <span class="math inline">\(f(x)\)</span>.
<ul>
<li>If <span class="math inline">\(f(b) &lt; f(x)\)</span>, the new interval is <span class="math inline">\((x, b, c)\)</span>.<br>
</li>
<li>If <span class="math inline">\(f(b) &gt; f(x)\)</span>, the new interval is <span class="math inline">\((a, x, b)\)</span>.</li>
</ul></li>
<li><strong>If</strong> the interval <span class="math inline">\((b, c)\)</span> is larger than <span class="math inline">\((a, b)\)</span>:<br>
Take <span class="math inline">\(x = (b + c)/2\)</span> and find <span class="math inline">\(f(x)\)</span>.
<ul>
<li>If <span class="math inline">\(f(b) &lt; f(x)\)</span>, the new interval is <span class="math inline">\((a, b, x)\)</span>.<br>
</li>
<li>If <span class="math inline">\(f(b) &gt; f(x)\)</span>, the new interval is <span class="math inline">\((b, x, c)\)</span>.</li>
</ul></li>
</ul>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the above algorithm, find the minimum of the polynomial</p>
<p><span class="math display">\[
f(x) = x^3 - 24x^2 + 6x + 15
\]</span></p>
<p>using the beginning bracket <span class="math inline">\((11, 15, 20)\)</span>. Print out intermediate results so that you know how many iterations the algorithm went through.</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Legendre polynomials appear in the solutions to Laplace’s equation in electrostatics, particularly for systems with spherical symmetries. For example, the general solution for the potential in 3-space, arrived at via separation of variables, takes the form:</p>
<p><span class="math display">\[
V(r, \theta) = \sum_{n=0}^{\infty} \left( A_n r^n + \frac{B_n}{r^{n+1}} \right) P_n(\cos \theta)
\]</span></p>
<p>where the coefficients <span class="math inline">\(A_n\)</span> and <span class="math inline">\(B_n\)</span> are determined by boundary conditions, and <span class="math inline">\(r\)</span> and <span class="math inline">\(\theta\)</span> are the radial distance and polar angle, respectively, in spherical coordinates.</p>
<p><span class="math inline">\(P_n\)</span> is the Legendre polynomial for the <span class="math inline">\(n\)</span>th harmonic, defined via the Rodrigues Formula as:</p>
<p><span class="math display">\[
P_n(x) = \frac{1}{2^n n!} \left( \frac{d}{dx} \right)^n (x^2 - 1)
\]</span></p>
<p>Write a C program to find the minimum of the <span class="math inline">\(n = 3\)</span> polynomial</p>
<p><span class="math display">\[
P_3(x) = \frac{1}{2}(5x^3 - 3x)
\]</span></p>
<p>using the initial bracket <span class="math inline">\((0.0, 0.5, 1.0)\)</span>. Print out intermediate results so that you know how many iterations the algorithm went through.</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recall that the Bessel function <span class="math inline">\(J_0(x)\)</span> is included in <code>comphys.c</code> as:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> bessj0<span class="op">(</span><span class="dt">float</span> x<span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Write a program that first invokes gnuplot to plot <span class="math inline">\(J_0(x)\)</span> between <span class="math inline">\(x = 0\)</span> and <span class="math inline">\(x = 15\)</span>, and then prompts the user to enter a triplet (<code>a, b, c</code>) to bracket one of the displayed minima of <span class="math inline">\(J_0(x)\)</span>. The program should then use bracketing and bisection to find the <span class="math inline">\(x\)</span> value of that minimum to a tolerance of <span class="math inline">\(1 \times
10^{-5}\)</span>. Hint: You can get gnuplot to plot <span class="math inline">\(J_0(x)\)</span> with the command:</p>
<pre class="text"><code>gnuplot&gt; plot besj0(x)</code></pre>
</div>
</div>
</section>
<section id="bracketing-a-minimum-in-1-d-with-derivatives" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="bracketing-a-minimum-in-1-d-with-derivatives"><span class="header-section-number">3.1.2</span> Bracketing a Minimum in 1-D with Derivatives</h3>
<p>In the previous section, we cornered the minimum of our function by successively reducing the size of the bracketing interval until we knew the location of the minimum to the desired precision. We did this by arbitrarily selecting a new evaluation point in the center of the <em>largest</em> interval, <span class="math inline">\((a, b)\)</span> or <span class="math inline">\((b, c)\)</span>. Now, this is inefficient, as the minimum may not be in the largest interval, and so our algorithm actually wasted nearly 50% of its steps. If we can calculate the derivative of the function, we can use this information to determine which interval the minimum is actually in and thus avoid wasting steps. Furthermore, if we retain the derivatives of the function at all bracketing points <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span>, then we can utilize linear <em>extrapolation</em> to predict where the derivative of the function goes to zero — i.e., the location of the minimum. This scheme should zero in on the minimum with far fewer steps than the previous algorithm.</p>
<p>This is how we proceed:</p>
<ol type="1">
<li><p>Evaluate the function and its derivative at each of the bracketing points <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span>.</p></li>
<li><p>Examine <span class="math inline">\(f'(b)\)</span>:</p>
<ul>
<li>If <span class="math inline">\(f'(b) &gt; 0\)</span>, the minimum is in the interval <span class="math inline">\((a, b)\)</span>.<br>
</li>
<li>If <span class="math inline">\(f'(b) &lt; 0\)</span>, the minimum is in <span class="math inline">\((b, c)\)</span>. See <a href="#fig-parab-min-div" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>.</li>
</ul></li>
<li><p>If <span class="math inline">\(f'(b) &lt; 0\)</span>, use <span class="math inline">\(f'(a)\)</span> and <span class="math inline">\(f'(b)\)</span> to extrapolate the derivative to 0.<br>
The straight line that passes through the points <span class="math inline">\((a, f'(a))\)</span> and <span class="math inline">\((b, f'(b))\)</span> is given by: <span class="math display">\[
y' = f'(a) + \frac{f'(b) - f'(a)}{b - a} (x - a)
\]</span> (The student should verify this). This can be used to extrapolate to <span class="math inline">\(y' = 0\)</span> by setting <span class="math inline">\(y' = 0\)</span> and solving for <span class="math inline">\(x\)</span>, yielding: <span class="math display">\[
x = a - \frac{f'(a)(b - a)}{f'(b) - f'(a)}
\]</span> We then calculate <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f'(x)\)</span>, and the new interval is <span class="math inline">\((b, x, c)\)</span>.</p></li>
<li><p>If <span class="math inline">\(f'(b) &gt; 0\)</span>, use <span class="math inline">\(f'(b)\)</span> and <span class="math inline">\(f'(c)\)</span> to extrapolate the derivative to 0.<br>
The straight line that passes through the points <span class="math inline">\((b, f'(b))\)</span> and <span class="math inline">\((c, f'(c))\)</span> is:</p>
<p><span class="math display">\[
y' = f'(b) + \frac{f'(c) - f'(b)}{c - b} (x - b)
\]</span></p>
<p>(The student should verify this.)</p>
<p>This can be used to extrapolate to <span class="math inline">\(y' = 0\)</span> by setting <span class="math inline">\(y' = 0\)</span> and solving for <span class="math inline">\(x\)</span>, yielding:</p>
<p><span class="math display">\[
x = b - \frac{f'(b)(c - b)}{f'(c) - f'(b)}
\]</span></p>
<p>We then calculate <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f'(x)\)</span>, and the new interval is <span class="math inline">\((a, x, b)\)</span>.</p></li>
<li><p>Go back to step (2) and continue until the minimum is isolated to the desired accuracy.</p></li>
</ol>
<div id="cell-fig-parab-min-div" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div id="fig-parab-min-div" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-parab-min-div-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-parab-min-div-output-1.png" width="471" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-parab-min-div-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: A parabola with derivative information
</figcaption>
</figure>
</div>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Modify your program for <strong>Exercise 6.1</strong> to include derivative information.<br>
Does the modified program take fewer steps to converge on the minimum?<br>
Does it do a better job at finding the minimum? How do you know?</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Re-do <strong>Exercise 6.2</strong> using derivative information.</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.6
</div>
</div>
<div class="callout-body-container callout-body">
<p>Re-do <strong>Exercise 6.3</strong> using derivative information. Recall that:</p>
<p><span class="math display">\[
\frac{dJ_0(x)}{dx} = -J_1(x)
\]</span></p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.7 — The Derivation of Wien’s Law
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wien’s law is a property of the blackbody spectrum and can be written as:</p>
<p><span class="math display">\[
\lambda_{\text{max}}(\text{Å}) = \frac{2.9 \times 10^{7}\ \text{ÅK}}{T(\text{K})}
\]</span></p>
<p>meaning that the wavelength of the maximum of the blackbody (Planck) spectrum is inversely proportional to the temperature.</p>
<p>The flux emitted by a blackbody (in units of erg s⁻¹ cm⁻² Å⁻¹) is given by:</p>
<p><span class="math display">\[
B(\lambda) = \frac{1.19106 \times 10^{27}}{\lambda^5 \left( e^{1.43879 \times 10^{8} / (\lambda T)} - 1 \right)}
\]</span></p>
<p>This function is coded in the C function <code>planck</code> found in <strong>comphys.c</strong>. The function definition is:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> planck<span class="op">(</span><span class="dt">float</span> wave<span class="op">,</span> <span class="dt">float</span> T<span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>where wave is the wavelength in Ångströms and T is the temperature in Kelvin.</p>
<p>Use the method of this section to determine the wavelength of the maximum of <span class="math inline">\(B(\lambda)\)</span> for the following temperatures: <span class="math inline">\(T = 2000\text{K}, 5000\text{K}, 8000\text{K}, 11000\text{K}, 14000\text{K}\)</span> and use gnuplot to plot these wavelengths against <span class="math inline">\(1/T\)</span> and show that the slope of the line is <span class="math inline">\(2.9 \times 10^7,\text{ÅK}\)</span>. To learn how to get gnuplot to do this for you, see the “aside” below. <em>Hint</em>: keep in mind that <span class="math inline">\(B(\lambda)\)</span> has a <em>maximum</em>, so determine the minimum of <span class="math inline">\(-B(\lambda)\)</span>. Another question to consider — how will you find the initial values of <span class="math inline">\((a, b, c)\)</span> which bracket the minimum of <span class="math inline">\(-B(\lambda)\)</span>? This is an important question — you will need to devise a C function that will come up with these three numbers.</p>
</div>
</div>
</section>
<section id="an-aside---how-to-get-gnuplot-to-fit-a-line-to-data" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="an-aside---how-to-get-gnuplot-to-fit-a-line-to-data"><span class="header-section-number">3.1.3</span> An Aside - How to get Gnuplot to fit a line to data</h3>
<p>Let us suppose that we have some data in the file <code>data.dat</code> and we want to get gnuplot to fit a regression line to those data. This is how to do it manually – the same commands can be used in “response” mode. Carry out the following steps:</p>
<pre class="text"><code>gnuplot &gt; plot "data.dat" using 1:2
gnuplot &gt; f(x) = a + b*x
gnuplot &gt; fit f(x) "data.dat" using 1:2 via a,b
gnuplot &gt; replot f(x)</code></pre>
<p>Gnuplot will calculate the regression line, and then display the values of the coefficients a and b along with associated errors.</p>
<p>How does one plot, say, the reciprocal of the first column of <code>data.dat</code> against the square of the second column? Use the following gnuplot command:</p>
<pre class="text"><code>gnuplot &gt; plot "data.dat" using (1/$1):($2*$2)</code></pre>
</section>
</section>
<section id="the-minimization-of-multi-dimensional-functions" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-minimization-of-multi-dimensional-functions"><span class="header-section-number">3.2</span> The Minimization of Multi-dimensional Functions</h2>
<p>The subject of the minimization of multidimensional functions, i.e.&nbsp;functions of the form<br>
<span class="math inline">\(y = f(x_1, x_2, x_3, \ldots)\)</span> is a huge subject, and we will only be able to scratch the surface.<br>
We begin with the so-called <em>downhill simplex method</em>.</p>
<section id="the-multidimensional-downhill-simplex-method" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="the-multidimensional-downhill-simplex-method"><span class="header-section-number">3.2.1</span> The Multidimensional Downhill Simplex Method</h3>
<p>A <em>simplex</em> is a geometrical figure consisting, in <span class="math inline">\(N\)</span> dimensions, of <span class="math inline">\(N + 1\)</span> vertices and all their interconnecting line segments, faces, etc. For <span class="math inline">\(N = 2\)</span>, the simplex is a triangle; for <span class="math inline">\(N = 3\)</span>, it is a tetrahedron, etc. In 1-D minimization, it is possible to bracket the minimum, but in multidimensional space, this is impossible. What we can do, however, is to <em>surround</em> the minimum with a <em>simplex</em> and then shrink that <em>simplex</em> until we know the position of the minimum to the desired precision. The way the <em>simplex</em> method works is as follows. Let us suppose we begin with a rough estimate of the position of the minimum in <span class="math inline">\(N\)</span>-dimensional space. This point <span class="math inline">\((x_1, x_2, \ldots, x_N)\)</span> makes up one of the vertices of the simplex. We then supply the remaining vertices of the simplex by adding a small value to each of the coordinates, thus: <span class="math display">\[
\begin{aligned}
&amp;(x_1 + \Delta x_1,\, x_2,\, \ldots,\, x_N), \\
&amp;(x_1,\, x_2 + \Delta x_2,\, \ldots,\, x_N), \\
&amp;\ldots, \\
&amp;(x_1,\, x_2,\, \ldots,\, x_N + \Delta x_N)
\end{aligned}
\]</span> The <span class="math inline">\(\Delta x_j\)</span>’s can all be the same, or they can be different, according to the needs of the problem. These <span class="math inline">\(N + 1\)</span> points define the initial simplex.</p>
<p>The downhill simplex method now takes a number of steps in the “downhill” direction in an attempt to find the minimum of the function. Most of these steps are in the form of reflections, in which the “highest” vertex of the simplex (i.e.&nbsp;the vertex at which the function evaluates to the highest value) is reflected through the opposite face of the simplex to a lower point. Other steps (see <a href="#fig-simplex" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>) involve reflection and expansion, or contraction. The goal is to surround the minimum and then contract on it until we know the minimum to the required precision. If you could watch the simplex in action, it would appear somewhat like an amoeba, first pursuing its prey and then engulfing it.</p>
<div id="fig-simplex" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-simplex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./assets/images/NRIC-Simplex.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simplex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Possible outcomes for a step in the downhill simplex method
</figcaption>
</figure>
</div>
<p>The C function <code>amoeba</code> — from <em>Numerical Recipes</em> <span class="citation" data-cites="press92">(<a href="references.html#ref-press92" role="doc-biblioref">Press et al. 1992</a>)</span> — implements the downhill simplex method. Since this algorithm may be a bit difficult for you to code yourself, we have given you this routine in <code>comphys.c</code>, and you will explore a number of applications of this routine.</p>
<p>The function definition for amoeba (contained in <code>comphys.h</code>) is:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> amoeba<span class="op">(</span><span class="dt">float</span> <span class="op">**</span>p<span class="op">,</span> <span class="dt">float</span> y<span class="op">[],</span> <span class="dt">int</span> ndim<span class="op">,</span> <span class="dt">float</span> ftol<span class="op">,</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> <span class="op">(*</span>funk<span class="op">)(</span><span class="dt">float</span> <span class="op">[]),</span> <span class="dt">int</span> <span class="op">*</span>nfunk<span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Here are the specific instructions for the use of <code>amoeba</code>, taken from <em>Numerical Recipes</em> <span class="citation" data-cites="press92">(<a href="references.html#ref-press92" role="doc-biblioref">Press et al. 1992</a>)</span>:</p>
<blockquote class="blockquote">
<p>Multidimensional minimization of the function <code>funk(x)</code> where <code>x[1...ndim]</code> is a vector in <code>ndim</code> dimensions, by the downhill simplex method of Nelder and Mead. The matrix <code>p[1..ndim+1][1..ndim]</code> is input. Its <code>ndim + 1</code> rows are <code>ndim</code>-dimensional vectors which are the vertices of the starting simplex. Also input is the vector <code>y[1..ndim+1]</code>, whose components must be preinitialized to the values of <code>funk</code> evaluated at the <code>ndim + 1</code> vertices (rows) of <code>p</code>; and <code>ftol</code>, the fractional convergence tolerance to be achieved in the function value. On output, <code>p</code> and <code>y</code> will have been reset to <code>ndim + 1</code> new points all within <code>ftol</code> of a minimum function value, and <code>nfunk</code> gives the number of function evaluations taken.</p>
</blockquote>
<p>This certainly sounds complicated, but it is fairly easy to use in practice.<br>
For an example, let us look at a C-program that will implement <code>amoeba</code> to solve a simple minimization problem where we find the minimum of the function</p>
<p><span class="math display">\[
f(x, y) = x^2 + (y - 1)^2 + 1.0
\]</span></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"comphys.h"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[]);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> <span class="op">**</span>p<span class="op">,*</span>y<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nfunk<span class="op">,</span>i<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> x0<span class="op">,</span>y0<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Allocate memory for the p matrix and the y vector */</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> matrix<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> vector<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* initial point */</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  x0 <span class="op">=</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  y0 <span class="op">=</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* define the vertices of the simplex - in this case a triangle */</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> x0<span class="op">;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> y0<span class="op">;</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> x0 <span class="op">+</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> y0<span class="op">;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> x0<span class="op">;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> y0 <span class="op">+</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* initiate y[i] */</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">3</span><span class="op">;</span>i<span class="op">++)</span> y<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> f<span class="op">(</span>p<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* invoke amoeba with ftol = 0.001 */</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  amoeba<span class="op">(</span>p<span class="op">,</span>y<span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="fl">0.001</span><span class="op">,</span>f<span class="op">,&amp;</span>nfunk<span class="op">);</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* the best value for the minimum is obtained by averaging the final</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">  p’s. */</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  x0 <span class="op">=</span> <span class="op">(</span>p<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">1</span><span class="op">]+</span>p<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">1</span><span class="op">]+</span>p<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">1</span><span class="op">])/</span><span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  y0 <span class="op">=</span> <span class="op">(</span>p<span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">2</span><span class="op">]+</span>p<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">2</span><span class="op">]+</span>p<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">])/</span><span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">The minimum is found at x0 = </span><span class="sc">%f</span><span class="st">, y0 = </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span>x0<span class="op">,</span>y0<span class="op">);</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"The number of function evaluations is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span>nfunk<span class="op">);</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">/* here is our function that we want to miminize */</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[])</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> z<span class="op">;</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  z <span class="op">=</span> x<span class="op">[</span><span class="dv">1</span><span class="op">]*</span>x<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span>x<span class="op">[</span><span class="dv">2</span><span class="op">]-</span><span class="fl">1.0</span><span class="op">)*(</span>x<span class="op">[</span><span class="dv">2</span><span class="op">]-</span><span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* print out intermediate values so we can see what is happening */</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">x[1] = </span><span class="sc">%f</span><span class="st"> x[2] = </span><span class="sc">%f</span><span class="st"> z = </span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span>x<span class="op">[</span><span class="dv">1</span><span class="op">],</span>x<span class="op">[</span><span class="dv">2</span><span class="op">],</span>z<span class="op">);</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span>z<span class="op">);</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The initial simplex looks like this:</p>
<div id="0bc80661" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-4-output-1.png" width="365" height="276" class="figure-img"></p>
<figcaption>A 3D simplex creates a triangle to encapulate the minima</figcaption>
</figure>
</div>
</div>
</div>
<p>In this case, both <span class="math inline">\(\Delta x\)</span> and <span class="math inline">\(\Delta y\)</span> are 1.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Exercise 6.8">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.8
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this exercise, we explore a very useful application of function minimization — optimizing a fit to a model. Consider the following data, which come from an exponentially decaying oscillating system:</p>
<div id="76dbae10" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-5-output-1.png" width="662" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The data are slightly noisy, but we can model these data with the equation</p>
<p><span class="math display">\[
f(t) = A e^{-\gamma t} \sin(Bt + C)
\]</span></p>
<p>We can consider the parameters <span class="math inline">\(A\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span> as variables, and ask our simplex algorithm <code>amoeba</code> to roam around in this four-dimensional space seeking the best fit (i.e., the fit with the smallest residual or <span class="math inline">\(\chi^2\)</span>) between this model and the data in the above figure.</p>
<p>These data are contained in the file <code>data/decay.out</code>. The first thing you must do is to read these data into your program. Consider the following code fragment, which can serve as the beginning of your program:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"comphys.h"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>t<span class="op">,*</span>yi<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> k<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[]);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> <span class="op">**</span>p<span class="op">,*</span>y<span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nfunk<span class="op">,</span>i<span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> A<span class="op">,</span>gam<span class="op">,</span>B<span class="op">,</span>C<span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">FILE</span> <span class="op">*</span>in<span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> matrix<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">5</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  y <span class="op">=</span> vector<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  t <span class="op">=</span> vector<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">200</span><span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  yi <span class="op">=</span> vector<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">200</span><span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span><span class="op">((</span>in <span class="op">=</span> fopen<span class="op">(</span><span class="st">"decay.out"</span><span class="op">,</span><span class="st">"r"</span><span class="op">))</span> <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Cannot find input file</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span><span class="op">(</span>fscanf<span class="op">(</span>in<span class="op">,</span><span class="st">"</span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f</span><span class="st">"</span><span class="op">,&amp;</span>t<span class="op">[</span>k<span class="op">],&amp;</span>yi<span class="op">[</span>k<span class="op">])</span> <span class="op">!=</span> EOF<span class="op">)</span> k<span class="op">++;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  fclose<span class="op">(</span>in<span class="op">);</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>What this code fragment does is to define two external vectors, <code>*t</code> and <code>*yi</code>, and then allocate space for them in the lines:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> vector<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">200</span><span class="op">);</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>yi <span class="op">=</span> vector<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">200</span><span class="op">);</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The next lines in the code open the file <code>decay.out</code> and then read the data from <code>decay.out</code> into the vectors <code>t</code> and <code>yi</code>. The file handle <code>in</code> is then closed.</p>
<p>The reason why we used external vectors was so that our function <code>f</code>, which is used by <code>amoeba</code>, would have access to these vectors. The function <code>f</code> calculates the residual or <span class="math inline">\(\chi^2\)</span> between the model and the data in <code>decay.out</code> using:</p>
<p><span class="math display">\[
\chi^2 = \sum_{i=0}^{k} (y_i - f(t_i))^2
\]</span></p>
<p>This value for <span class="math inline">\(\chi^2\)</span> is then returned. This is accomplished in the code:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[])</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> y1<span class="op">,</span>chi2<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  chi2 <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">0</span><span class="op">;</span>i<span class="op">&lt;</span>k<span class="op">;</span>i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> x<span class="op">[</span><span class="dv">1</span><span class="op">]*</span>exp<span class="op">(-</span>x<span class="op">[</span><span class="dv">2</span><span class="op">]*</span>t<span class="op">[</span>i<span class="op">])*</span>sin<span class="op">(</span>x<span class="op">[</span><span class="dv">3</span><span class="op">]*</span>t<span class="op">[</span>i<span class="op">]</span> <span class="op">+</span> x<span class="op">[</span><span class="dv">4</span><span class="op">]);</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    chi2 <span class="op">+=</span> <span class="op">(</span>y1 <span class="op">-</span> yi<span class="op">[</span>i<span class="op">])*(</span>y1 <span class="op">-</span> yi<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">chi2 = </span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span>chi2<span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span>chi2<span class="op">);</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>What remains for you to do is to figure out reasonable starting values for <span class="math inline">\(A\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(B\)</span>, and <span class="math inline">\(C\)</span>, use them to initialize the components of p, and then to invoke amoeba. The next figure shows a plot of what I got.</p>
<div id="59ac7964" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-6-output-1.png" width="662" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Exercise 6.9">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.9
</div>
</div>
<div class="callout-body-container callout-body">
<p>The restricted 3-body problem of classical mechanics leads to a non-dimensionalized potential energy surface given by the equation:</p>
<p><span class="math display">\[
V(x, y) = \left\{
\frac{\xi_2}{\left[(x - \xi_1)^2 + y^2\right]^{1/2}}
- \frac{\xi_1}{\left[(x - \xi_2)^2 + y^2\right]^{1/2}}
- \frac{1}{2}(x^2 + y^2)
\right\}
\]</span></p>
<p>where <span class="math inline">\(0 &lt; \xi_1 &lt; 1\)</span> and <span class="math inline">\(\xi_2 = \xi_1 - 1\)</span>. It turns out that this potential surface has 5 extrema, three minima (<span class="math inline">\(L_1\)</span>, <span class="math inline">\(L_2\)</span>, and <span class="math inline">\(L_3\)</span>), which all lie along the x-axis, and two maxima (<span class="math inline">\(L_4\)</span> and <span class="math inline">\(L_5\)</span>). For small values of <span class="math inline">\(\xi_1\)</span>, <span class="math inline">\(L_4\)</span> will be in the second quadrant and approximately located at a point 1 unit away from the origin along a line inclined <span class="math inline">\(60^\circ\)</span> to the <span class="math inline">\(-x\)</span> axis. As <span class="math inline">\(\xi_1\)</span> increases, <span class="math inline">\(L_4\)</span> moves closer to the y-axis and lies on the y-axis for <span class="math inline">\(\xi_1 = 0.5\)</span>. <span class="math inline">\(L_5\)</span> is located similarly in the third quadrant. Write a program that will prompt the user for <span class="math inline">\(\xi_1\)</span>, check that <span class="math inline">\(\xi_1 \le
0.50\)</span>, and then find the coordinates of <span class="math inline">\(L_4\)</span> using the simplex method.</p>
</div>
</div>
</section>
<section id="powells-method" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="powells-method"><span class="header-section-number">3.2.2</span> Powell’s Method</h3>
<p>The downhill simplex method has the virtue that it is easy to implement, and often will do the job as well as other much more sophisticated methods. A problem with the simplex method is that it uses more function evaluations than other multidimensional minimization techniques, and if evaluating your function is computationally expensive, then the simplex method can be very slow. So, if you are dealing with a complicated, computationally expensive function, it is worthwhile to investigate other methods.</p>
<p>One straightforward way to minimize a multidimensional function is to use the methods of <a href="#sec-min-1D" class="quarto-xref"><span>Section 3.1</span></a> to minimize first along one direction, then along the next and so on until you spiral into the minimum — i.e., if <span class="math inline">\(y = f(x_1, x_2,
x_3, \ldots)\)</span>, hold <span class="math inline">\(x_2, x_3, \ldots\)</span> constant and minimize <span class="math inline">\(f\)</span> along <span class="math inline">\(x_1\)</span>, then hold <span class="math inline">\(x_1, x_3, \ldots\)</span> constant and minimize along <span class="math inline">\(x_2\)</span>, and so on, cycling through the directions until you know the minimum to the desired precision. This is actually a very good algorithm to follow in most situations, especially if the minimum of your function is nice and symmetric, as is quite often the case. However, the method becomes very inefficient if the minimum is found at the bottom of a long, narrow valley. Then the method will have to cycle through the directions many, many times, bouncing against the sides of this valley to get to the minimum.</p>
<p>The key is to abandon the coordinate directions <span class="math inline">\(x_1, x_2, x_3, \ldots\)</span> and instead use a new basis set of “conjugate directions”, with the idea that the first of these directions will be along the direction of maximum descent — i.e., along the direction of that long narrow valley. The algorithm moves as far as it can along this direction; it then abandons that direction and finds the next direction of maximum descent, and so on, until the actual function minimum is found. This is the basis of Powell’s method, which is implemented in the C-function <code>powell</code> found in <code>comphys.c</code>. The function definition is</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> powell<span class="op">(</span><span class="dt">float</span> p<span class="op">[],</span> <span class="dt">float</span> <span class="op">**</span>xi<span class="op">,</span> <span class="dt">int</span> n<span class="op">,</span> <span class="dt">float</span> ftol<span class="op">,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>iter<span class="op">,</span> <span class="dt">float</span> <span class="op">*</span>fret<span class="op">,</span> <span class="dt">float</span> <span class="op">(*</span>func<span class="op">)(</span><span class="dt">float</span> <span class="op">[]))</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <em>Numerical Recipes</em> instructions for this function are as follows:</p>
<blockquote class="blockquote">
<p>Minimization of a function <code>func</code> of <code>n</code> variables. Input consists of an initial starting point <code>p[1...n]</code>; an initial matrix <code>xi[1..n][1..n]</code>, whose columns contain the initial set of directions (usually the <em>n</em> unit vectors); and <code>ftol</code>, the fractional tolerance in the function value such that failure to decrease by more than this amount on one iteration signals doneness. On output, <code>p</code> is set to the best point found, <code>xi</code> is the then-current direction set, <code>fret</code> is the returned function value at <code>p</code>, and <code>iter</code> is the number of iterations taken.</p>
</blockquote>
<p>Let us use Powell’s method to minimize the function <span class="math inline">\(f(x, y) = x^2 + (y - 1)^2 + 1.0\)</span> of the previous section. The following program does the job:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"comphys.h"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[]);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> <span class="op">*</span>p<span class="op">,**</span>xi<span class="op">,</span>fret<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> iter<span class="op">=</span><span class="dv">0</span><span class="op">;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> i<span class="op">,</span>j<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> x0<span class="op">,</span>y0<span class="op">;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Allocate memory for the p vector and the xi matrix */</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> vector<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  xi <span class="op">=</span> matrix<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* initial point */</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  x0 <span class="op">=</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  y0 <span class="op">=</span> <span class="fl">5.0</span><span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> x0<span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  p<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> y0<span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Initial directions */</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span>i<span class="op">=</span><span class="dv">1</span><span class="op">;</span>i<span class="op">&lt;=</span><span class="dv">2</span><span class="op">;</span>i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span>j<span class="op">=</span><span class="dv">1</span><span class="op">;</span>j<span class="op">&lt;=</span><span class="dv">2</span><span class="op">;</span>j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>i <span class="op">==</span> j<span class="op">)</span> xi<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> xi<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* invoke powell with ftol = 0.001 */</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  powell<span class="op">(</span>p<span class="op">,</span>xi<span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="fl">0.001</span><span class="op">,&amp;</span>iter<span class="op">,&amp;</span>fret<span class="op">,</span>f<span class="op">);</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">The minimum is found at x = </span><span class="sc">%f</span><span class="st">, y = </span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span>p<span class="op">[</span><span class="dv">1</span><span class="op">],</span>p<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">The value of f at the minimum is </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span>fret<span class="op">);</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co">/* here is our function that we want to minimize */</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> f<span class="op">(</span><span class="dt">float</span> x<span class="op">[])</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> tmp<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> z<span class="op">;</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  z <span class="op">=</span> x<span class="op">[</span><span class="dv">1</span><span class="op">]*</span>x<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span>x<span class="op">[</span><span class="dv">2</span><span class="op">]-</span><span class="fl">1.0</span><span class="op">)*(</span>x<span class="op">[</span><span class="dv">2</span><span class="op">]-</span><span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* print out intermediate values so we can see what is happening */</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">x[1] = </span><span class="sc">%f</span><span class="st"> x[2] = </span><span class="sc">%f</span><span class="st"> z = </span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span>x<span class="op">[</span><span class="dv">1</span><span class="op">],</span>x<span class="op">[</span><span class="dv">2</span><span class="op">],</span>z<span class="op">);</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span>z<span class="op">);</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.10
</div>
</div>
<div class="callout-body-container callout-body">
<p>Repeat Exercise 6.8 using Powell’s method.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Exercise 6.11
</div>
</div>
<div class="callout-body-container callout-body">
<p>Repeat Exercise 6.9 using Powell’s method.</p>
</div>
</div>
</section>
</section>
<section id="optimization-in-python" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="optimization-in-python"><span class="header-section-number">3.3</span> Optimization in Python</h2>
<p>Optimization is a vast subject. SciPy has got you covered with the <a href="https://docs.scipy.org/doc/scipy/reference/optimize.html" target="_blank">optimize</a> subpackages, which we previously met in <a href="05-roots.html" class="quarto-xref"><span>Chapter 2</span></a> for all of our root finding needs.</p>
<p>For scalar functions the <code>minimize_scalar</code> method is used. As an example we will return to our favorite wiggle</p>
<div id="164e0402" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.special <span class="im">import</span> j0</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize_scalar</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">'figure.figsize'</span>: (<span class="dv">7</span>, <span class="dv">2</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">'axes.spines.top'</span>: <span class="va">False</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">'axes.spines.right'</span>: <span class="va">False</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">400</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>plt.plot(x, j0(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-7-output-1.png" width="571" height="189" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The call to <code>minimize_scalar</code> returns an object with other information about the result.</p>
<div id="33e665f6" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize_scalar(j0)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code> message: 
          Optimization terminated successfully;
          The returned value satisfies the termination criteria
          (using xtol = 1.48e-08 )
 success: True
     fun: -0.4027593957025531
       x: 3.8317059554863437
     nit: 9
    nfev: 13</code></pre>
</div>
</div>
<p>Notice there are many function evaluations. If your function is expensive to evaluate, minimization can be expensive.</p>
<div id="5af36cd3" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plt.plot(x, j0(x))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plt.plot(result.x, result.fun, <span class="st">'o'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-9-output-1.png" width="571" height="189" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note this is a local minium. Passing a bracket we can find multiple local minima</p>
<div id="ef53e1fc" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>bracket <span class="op">=</span> [[<span class="dv">2</span>,<span class="dv">4</span>], [<span class="dv">8</span>, <span class="dv">10</span>], [<span class="dv">14</span>, <span class="dv">16</span>]]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> b <span class="kw">in</span> bracket:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    results.append(minimize_scalar(j0, bracket<span class="op">=</span>b))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>ax.plot(x, j0(x))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mini <span class="kw">in</span> results:</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(mini.x, mini.fun, <span class="st">'o'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="06-extrema_files/figure-html/cell-10-output-1.png" width="571" height="189" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>For a multi-dimensional example consider the example of the Rosenbrock function</p>
<p><span class="math display">\[
f\left(\mathbf{x}\right)=\sum_{i=1}^{N-1}100\left(x_{i+1}-x_{i}^{2}\right)^{2}+\left(1-x_{i}\right)^{2}
\]</span></p>
<p>Don’t worry too much about the exact form of the equation. The Rosenbrock function is a horseshoe type valley shown in <a href="#fig-rosen-1" class="quarto-xref">Figure&nbsp;<span>3.4 (a)</span></a>. The Rosenbrock function is used as a benchmark for optimization techniques as it can be difficult for methods to navigate the shallow curved valley.</p>
<div id="fig-rosen" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rosen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-rosen" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-rosen-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-rosen-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-rosen-output-1.png" data-ref-parent="fig-rosen" width="392" height="394" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-rosen-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) The funtion forms a shallow horseshoe valley
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-rosen" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-rosen-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-rosen-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-rosen-output-2.png" data-ref-parent="fig-rosen" width="376" height="358" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-rosen-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) The minimum of the fucntion is at <span class="math inline">\((x, y) = (1, 1)\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rosen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: The Rosenbrock function
</figcaption>
</figure>
</div>
<p>The Rosenbrock function as a minimum at <span class="math inline">\(f(x,y)=f(1,1)=0\)</span> shown in <a href="#fig-rosen-2" class="quarto-xref">Figure&nbsp;<span>3.4 (b)</span></a>.</p>
<p>The Rosenbrock function is so commonly used in optimization that SciPy provides an method <code>rosen</code>.</p>
<div id="1cb4b6c0" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> rosen</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rosen([<span class="dv">1</span>, <span class="dv">2</span>]))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rosen([<span class="op">-</span><span class="dv">15</span>, <span class="dv">25</span>]))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rosen([<span class="dv">1</span>,<span class="dv">1</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>100.0
4000256.0
0.0</code></pre>
</div>
</div>
<p>Let’s say we start at a point <span class="math inline">\((-1.5, 2.5)\)</span> and we want to minimize the function. For multivariet minimization, SciPy provides the <code>minimize</code> method.</p>
<div id="2fb5340b" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.array([<span class="op">-</span><span class="fl">1.5</span>, <span class="fl">2.5</span>])</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> minimize(rosen, x0)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>  message: Optimization terminated successfully.
  success: True
   status: 0
      fun: 2.008444162310784e-11
        x: [ 1.000e+00  1.000e+00]
      nit: 36
      jac: [-3.771e-07  1.852e-07]
 hess_inv: [[ 5.000e-01  1.000e+00]
            [ 1.000e+00  2.005e+00]]
     nfev: 144
     njev: 48</code></pre>
</div>
</div>
<p>Again as with the root finding methods, the results contain more than just the minimum. In this case we also get the number of function evaluates and an estimate of the jacobian and hessian. The defauly method is <code>'BFGS'</code> but you can pass which method you want to use such as <code>Nelder-Mead</code></p>
<div id="c3f8fd94" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>minimize(rosen, x0, method<span class="op">=</span><span class="st">'Nelder-Mead'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>       message: Optimization terminated successfully.
       success: True
        status: 0
           fun: 6.446298475670153e-10
             x: [ 1.000e+00  1.000e+00]
           nit: 97
          nfev: 182
 final_simplex: (array([[ 1.000e+00,  1.000e+00],
                       [ 1.000e+00,  9.999e-01],
                       [ 1.000e+00,  1.000e+00]]), array([ 6.446e-10,  1.465e-09,  1.635e-09]))</code></pre>
</div>
</div>
<p>in which case we are returned the final simplex. Notice there were a few more function evaluations but not so bad compared to the default.</p>
<p>Consider our good old friend <code>Powell</code></p>
<div id="d29b46c2" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>minimize(rosen, x0, method<span class="op">=</span><span class="st">'Powell'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code> message: Optimization terminated successfully.
 success: True
  status: 0
     fun: 9.860761315262648e-30
       x: [ 1.000e+00  1.000e+00]
     nit: 26
   direc: [[ 4.521e-02  9.181e-02]
           [ 1.075e-07  1.814e-07]]
    nfev: 686</code></pre>
</div>
</div>
<p>and notice how poorly it performs on this function. Navigating around the valley resulted in many more function evaluations. If can be instructive to view both methods side by side and see what path they take.</p>
<div id="fig-min-path" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-min-path-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-min-path" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-min-path-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-min-path-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-min-path-output-1.png" data-ref-parent="fig-min-path" width="376" height="358" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-min-path-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Nelder-Mead: Takes a rough path but gets there in due time
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-min-path" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-min-path-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-min-path-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-extrema_files/figure-html/fig-min-path-output-2.png" data-ref-parent="fig-min-path" width="376" height="358" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-min-path-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Powell: Really struggles with the diagonal route.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-min-path-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Comparing optimization traces
</figcaption>
</figure>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-press92" class="csl-entry" role="listitem">
Press, William H., Saul A. Teukolsky, William T. Vetterling, and Brian P. Flannery. 1992. <em>Numerical Recipes in c (2nd Ed.): The Art of Scientific Computing</em>. USA: Cambridge University Press.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05-roots.html" class="pagination-link" aria-label="Finding the Root of a Function">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Finding the Root of a Function</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-integration.html" class="pagination-link" aria-label="Numerical Integration">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Numerical Integration</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>